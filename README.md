<p align="center">
    <img width="100" src="https://cdn1.savepice.ru/uploads/2020/9/14/2bf770bded52d8a3cf4fde7479eb1b02-full.png" title="Doomarket">
</p>


<h2 align="center">Doomarket</h2>

#### Doomarket - Cart Functionality market ####

#### Foreword/Предисловие
Данный проект создавался преимущественно в целях демонстрации возможностей фреймворка Django на языке программирования Python. Хотя небольшая часть проекта так же демонстрирует работу и с Frontend технологиями, все же акцент больше сделан на работе разработчика (меня) с технологиями именно фреймворка Django. От этого не исключены небольшие недоработки по Frontend части сайта, где большая часть времени была выделена и отдана на разработку Backend составляющих. При всем этом так же хотелось бы отметить, что небольшие недоработки в той или инной мере так же могут присутствовать и в Backend части, что естественно будет дорабатываться в последующих <a href="#Release2">релизах</a> и некоторые недоработки уже отражены в задачах на последующие релизы.<br><br>
Так же хотелось бы отметить, что перенос отдельных задач на последующие релизы обуславливается: их схожей функциональностью с уже имеющимися технологиями на сайте, с выделением времени на более приоритетные задачи (поскольку каждую технологию необходимо изучить, понять как она работает и реализовать на сайте)   

#### Description/Описание
Doomarket - является e-commerce, cart functionality сайтом (интернет-магазином), реализованным по шаблону проектирования Model-View-Controller. Архитектура модели построена по классической <a href="https://en.wikipedia.org/wiki/Entity%E2%80%93attribute%E2%80%93value_model">Entity–attribute–value-модели</a>. Модель включает в себя взаимодействие друг с другом: значениий товаров, свойств товаров, собственно самих товаров и типов товаров. Более подробно про модель описано в разделе <a href="#EAV">*"ORM, описание EAV модели сайта"*.</a> <br><br>
По возможности код написан таким образом, что вся бизнес логика, утилиты и миксины вынесены за пределами *Views* и *Models*. Насколько возможно, в рамках собственной квалификации был соблюден принцип DRY.
- На сайте присутствуют разделы категорий товаров, подкатегорий товаров и типов товаров - с аналогичным каждому из объектов ассортиментом. <br><br>
- Так же в разделе "Тип товара" присутствуют фильры сортировки продуктов по характеристикам товара (свойствам и значениям). К сожалению на данный момент фильтры ограничены функцианированием только внутри приложения shop, от чего взаимодействие с ними через административную панель не ведется и ограничивает их функционал. Но для общей демонстрации, полагаю, этого будет достаточно. В дальнейших релизах фильтры будут перенесены в отдельное приложение где их функции будут более обширными. С работой и взаимодействием с фильтрами более подробно можно ознакомиться в главе "Использование"-"Приложение shop"-"Фильтры"<br><br>
- Каждый товар имеет карточку товара внутри которой расположено название товара, артикул, слайдер с изображениями товара, краткие характеристики каждого товара, описание товара, функция добавить в корзину, цена, слайдер рекомендаций товаров по наиболее часто приобретаемым продуктам.<br><br>
- Рекомендации товаров на данный момент реализованы не до конца, но при этом полностью функционируют и работают верно. Тестирование работы рекомендаций, можно посмотреть в разделе "Использование" - "Приложение shop" - "Рекомендации"<br><br>
- Корзина реализована за счет подсистемы сессий Django. Ajax-запросов добавления товаров в корзину, к сожалению не реализовано, по причине экономия времени, поскольку в той или инной мере похожим образом, за счет Ajax-запросов реализован функционал у фильтров. Тем самым осуществлена демонстрация работы с Ajax. Корзина включает в себя добавленные продукты, возможность удалять продукты из корзины, менять количество продуктов, добавлять выбранные тованы на оформление заказа. Подробнее про корзину можно прочитать в главе "Использование" - "Приложение cart"<br><br>
- В коризне присутствует возможность вводить промо-коды на скидку, подробнее в разделе "Использование" - "Приложение coupons"<br><br>
- Оформление заказа отправляет данные клиента в административную панель. В следующих релизах планируется добавление платежной системы, на данный момент система не реализована по причине технических неполадок с Erlang. Но если у Вас есть возможность запустить сервер RabbitMQ на этот случай присутствует Celety таск по отправке уведомления клиенту на почту, после заказа. Установка RabbitMQ и реализация таска будет продемонстрирована в разделе "Установка" и "Использование" - "Приложение orders" - "Celery"<br><br>
- На все страницы со списками продуктов реализована пагинация.<br><br>
- В футере сайта доступна интернацианализация (мультиязычность). Все основные функции перевода добавлены, работа с переводом продемонстрирована. Перевод осуществлен не полностью, так как по большей части это уже работа с контентом, а не разработка. Показаны основные возможности перевода.<br><br>
- Реализованы авторизация, регистрация, восстановление пароля.<br><br>
- Добавлены Flatpages для создания шаблонов и добавления контента на них через административную панель.

#### Общее описание релиза 1.0
Приложение shop:
- Entity–attribute–value-модель
- Продукты
- Свойства продуктов
- Значения свойств продуктов
- AJAX Фильтрация свойств продуктов
- Регистрация, вход, восстановление пароля
- Каталог товаров, разделенный на категории
- Рекомендации
- Утилита генерация slug-a, транслит поля name
- Перевод
- Пагинация
- Поиск
- Тесты Views, Urls

Приложение orders:
- Оформление заказа
- Celery task на отправку уведомлений клиенту
- Экспорт заказов в CSV

Приложение cart:
- Добавление продуктов в корзину товаров
- Форма добавления по количеству товаров прямо из списка товаров, из карточки и в самой корзине
- Подсчет общей стоимости товаров путем сложения всех цен
- Удаление товаров из корзины
- Добавлен простой контекстный процессор, показывающий количество товаров в корзине

Приложение coupons:
- Пересчет общей стоимости цены в корзине с учетом промо-кода
- Пересчет общей стоимости цены в оформлении заказа с учетом промо-кода
- Добавление учета пересчета цены в оформление заказа, оформление по цене дисконта
- Добавление учета дисконта в административную панель и учет дисконта в заказе

Frontend:
- Виджет OWL Carousel
- Карусель в карточках товаров
- JQuery Кнопка наверх

С демонстраций этих и многих других функций вы можете ознакомиться полностью установив проект с виртуальным окружением на свою операционную систему. Инструкция по установке указана в разделе "Установка"

#### <a name="#Release2">Описание ожидаемых изменений релиза 2.0</a>
- Избранное:
  + Демонстрацию избранного в полной мере осуществляет работа с корзиной и выполняет похожие функции, поэтому избранное будет добавлено позже.

- Генерация PDF-счетов:
  + Будет добавлена возможность генерировать pdf-счета заказов и отправлять их по почте после обработки заказа.

- Отдельное приложение фильтров:
  + Работу фильтров в полной мере демонстрирует класс FiltersPropertyValuesList. Поскольку это не удобный функционал для взаимодействия с ними, через административную панель, так же фильтры должны отличаться по типу фильтра (диапазональный, текстовый и т.д) - перенос фильтров как отдельное приложение планируется.
  
- CSV-парсер отдельное приложение:
  + Основную работу с экспортом в csv формат сейчас демонстрирует экспорт заказов, но с небольшим ограничением. В дальнейших релизах планируется добавление импорта и переноса экспорта с импортом на другие модели, помимо заказов.
 
- Подключение платежного шлюза Braintree:
  + В связи с техническими неполдками в работе с Erlang и не возможнотью протестировать в полной мере работу системы демонстрация платежного шлюза возможна к осуществлению в дальнейших релизах. На данный момент работу с Celery и брокера Rabbit MQ все же можно продемонстрировать на примере отправки письма по таску Celery.
 
- Купоны по product-type:
  + На данный момент осуществлено базовое взаимодействие с купонами, в дальнейших релизах будет осуществлена разработка над их функциональными качествами такими как: создание купонов и привязка их к конкретным product type что позволит создавать купон на конкретный тип продукта, так же не исключено взаимодействие с product.
  
- Расширенный поиск:
  + На данный момент реализована демонстрация поиска по названию товара, в дальнейших релизах будет осуществлен поиск по свойствам, по значениям, поиск по категориям.

- Полный перевод:
  + В релиз 1.0 перевод был добавлен в качестве демонстрации взаимодействия с `i18n_patterns`, перевод контента не сильно важен для демонстрации разработки, поэтому дальнейшие взаимодействия с переводом будут возобновлены с появлением времени на работу с контентом.
  
- Рекомендации:
  + Работу рекомендаций в полной мере можно протестировать с помощью `Redis` сервера и `py shell`, но на данный момент на сайте сама работа рекомендаций находится в разработке. Сам функционал рекомендаций полностью готов и протетирован, туториал по тестированию можно найти в разделе "Использование" - "Приложение shop" - "Рекомендации".
  
- Корзина AJAX:
  + На данный момент работа корзины осуществлена с помощью подсистемы сессий Django, без ajax-запросов. В дальнейшем планируется добавление ajax.
  
- Значения:
  + Корректировка модели Value по типу данных в значении, разделение значения на булевое, числовое, текстовое.
  
- Модальные окна в карточке товаров:
  + На данный момент модальные окна в разделе просмотра фотографий в карточке товара - не добавлены. По причине того, что проект создавался с целью демонстрации разработки и взаимодействия с Django фреймворком, а не демонстрации Frontend технологий. Но такая задача поставлена и будет реализована в последующих релизах, как только будут решены остальные задачи в очереди.
  
- Выпадающий список, поиска по категориям:
  + На данный момент выпадающий список категорий, написан на чистом CSS и HTML, без JS. В дальнейшем планируется - открытие списка по щелчку и отображение подкатегорий и типа продуктов при наведении на категорию в списке.

- Адаптирование некоторых страниц:
  + Хоть сайт и адаптирован под мобильные устройства, но к сожалению, не на всех страницах. Верстка в последствии будет доделана.

#### Установка
Перед началом необходимо произвести клонирование репозитория на свою операционную систему.

##### Virtual env. activate #####
Windows:
```
 path\to\env\Scripts\activate
```

Linux:
```
source env/bin/activate
```

##### Requirements install #####
Windows:
```
pip install requirements.txt
```

Linux:
```
cd 'Project_name'
pip install virtualenvwrapper
mkvirtualenv "name_your_project"
cat requirements.txt
pip3 install -r requirements.txt
```

##### Установка Redis
Redis - хранит ключ каждого купленного товара, по этим ключам будет формироваться рейтинг. Это необходимо для реализации системы, которая будет выдавать покупателям рекомендуемые товары в зависимости от того, что они положили в корзину.

Проект Redis официально не поддерживает Windows.<br>

 - Все настройки подключения Redis хранятся в `settings.py` проекта, в разделе "Redis configuration"
 - Вы можете загрузить различные версии или последнюю версию <a href="github.com/MSOpenTech/redis/releases">Redis</a>
 - Загрузите файл .msi или .zip
 - Извлеките zip-файл в подготовленный каталог
 - Запустите redis-server.exe , вы можете напрямую запустить redis-server.exe, щелкнув или запустив его в командной строке.<br><br>
<img src="https://i.stack.imgur.com/lKqjc.png"><br><br>
 
 
 - Запустите redis-cli.exe после успешного запуска redis-сервера. Вы можете получить к нему доступ и проверить команды, запустив redis-cli.exe<br><br>
<img src="https://i.stack.imgur.com/BenT1.png"><br><br>
 
 - Команда PING используется для проверки работоспособности соединения<br><br>
<img src="https://i.stack.imgur.com/MA66K.png"><br><br> 

 Примечание: Убедитесь в том, что локальный сервер Redis запущен по указанному порту `6379` в `settings.py`, в противном случае локальный сервер Django не будет запущен и выдаст ошибку.<br>
<hr>


##### Установка брокера RabbitMQ
RabbitMQ - это система обмена сообщениями между приложениями он является рекомендуемым брокером для Celery.<br>
С помощью Celery мы выполняем асинхронные задачи на сайте. Такие как отправка клиенту по почте сообщения о заказе. Более подробно в разделе "Приложение orders".<br>

####Важно!: 
#####Имя компьютера в системе должно быть на латинице и в нижнем регистре. Иначе Erlang работать не будет.

- Установить <a href="https://www.erlang.org/downloads">Erlang</a>
- Скачать с официального сайта RabbitMQ <a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.8/rabbitmq-server-3.8.8.exe">Installer for Windows systems (from GitHub, recommended)</a>
- <a href="https://www.rabbitmq.com/download.html">Linux installer, в зависимости от дистрибутива</a>
- В поиске набираем CMD и из списка можно выбрать два варианта, консоль от RabbitMQ или консоль от Windows
- Если выбрали от Windows то выполняем команду:
  + ```cd C:\Program Files\RabbitMQ Server\rabbitmq_server-3.6.11\sbin```
- Запускаем установку сервера 
  + ```rabbitmq-service install```
- Проверяем статус сервера 
  + ```rabbitmqctl status```
- Устанавливаем менеджмент плагин 
  + ```rabbitmq-plugins enable rabbitmq_management```
- Делаем рестарт сервера
  + ```rabbitmq-service stop```
  + ```rabbitmq-service start```
  
####Готово
Заходим в админку <a href="http://localhost:15672">RabbitMQ</a><br>

Порт: 15672<br>

- Логин: guest
- Пароль: guest
#



###### Установка PostgreSQL и создание базы данных не составит существенных трудностей на Windows. Поскольку данная база данных имеет как визуальное управление базами данных pgAdmin, так и работать в ней можно и через консоль.
##### Поэтому продемонстрируем только установку в консоли Linux:
- Установка:
  + ```sudo apt-get install postgresql pgadmin3 ```
- Среда PostgreSQL:
  + ```sudo	-u postgres psql ```
- Смена пароля для user-а postgres:
  + ```postgres=# \password```
- Создание базы данных:
  + ```postgres=# CREATE DATABASE name_your_database```
- Просмотреть созданные базы данных:
  + ```postgres=# \l```

###Использование
####<a name="#EAV">ORM, описание EAV модели сайта</a>
Модели Doomarket построены по модели Entity-Attribute-Value – это модель данных, которая благодаря использованию сущностей, атрибутов и их значений обеспечивает большую гибкость при создании новых данных.<br>

<img src="https://i.stack.imgur.com/CCocZ.png">

#####Cтруктура EAV-модели Doomarket, архитектура базы данных
Для демонстрации внедрения EAV модели показаны сущности(объекты в моделях) только учавствующие в самой EAV-модели. Второстепенные сущности- "Category", "Subcategory", "Img"  и т.д. не указаны. 
#####ProductType;<br> Объект ProductType(Тип продукта) 
<table>
    <thead>
        <th>id</th>
        <th>name</th>
    </thead>
    <tbody>
        <tr>
	        <td>1</td>
	        <td>Смартфон</td>
	    </tr>
	    <tr>
	        <td>2</td>
	        <td>Смарт-часы</td>
	    </tr>
</table>

#####ProductInstance; <br> Объект Product(Конкретный продукт) 
<table>
    <thead>
        <th>id</th>
        <th>product_type_id</th>
        <th>name</th>
    </thead>
    <tbody>
        <tr>
	        <td>1</td>
	        <td>1</td>
	        <td>Samsung galaxy s10</td>
	    </tr>
	    <tr>
	        <td>2</td>
	        <td>1</td>
	        <td>Apple iphone x</td>
	    </tr>
	    <tr>
	        <td>3</td>
	        <td>2</td>
	        <td>Apple Watch</td>
	    </tr>
	    <tr>
	        <td>4</td>
	        <td>2</td>
	        <td>Samsung Watch</td>
	    </tr>
</table>

#####PropertyType; <br> Объект Property(тип характеристики, свойство) 
<table>
    <thead>
        <th>id</th>
        <th>product_type_id</th>
        <th>name</th>
        <th>type</th>
    </thead>
    <tbody>
        <tr>
	        <td>1</td>
	        <td>1</td>
	        <td>Камера</td>
	        <td>Boolean</td>
	    </tr>
	    <tr>
	        <td>2</td>
	        <td>1</td>
	        <td>ОС</td>
	        <td>String</td>
	    </tr>
	    <tr>
	        <td>3</td>
	        <td>2</td>
	        <td>Вес</td>
	        <td>Decimal</td>
	    </tr>
	    <tr>
	        <td>4</td>
	        <td>2</td>
	        <td>Длина ремешка</td>
	        <td>Integer</td>
	    </tr>
</table>

#####PropertyInstance; <br> Объект Value(значение характеристики конкретного продукта) 
<table>
    <thead>
        <th>id</th>
        <th>product_instance_id</th>
        <th>property_type_id</th>
        <th>Value</th>
    </thead>
    <tbody>
        <tr>
	        <td>1</td>
	        <td>1</td>
	        <td>1</td>
	        <td>Да</td>
	    </tr>
	    <tr>
	        <td>2</td>
	        <td>1</td>
	        <td>2</td>
	        <td>Android</td>
	    </tr>
	    <tr>
	        <td>3</td>
	        <td>2</td>
	        <td>1</td>
	        <td>Да</td>
	    </tr>
	    <tr>
	        <td>4</td>
	        <td>2</td>
	        <td>2</td>
	        <td>IOS</td>
	    </tr>
</table>


##### Краткое описание работы с кодом по поводу бизнес логики и утилит
##### Приложение shop - здесь redis якорь на business.recommender, так же берем views и объясняем про каждый соданный самостоятельно класс
##### Приложение orders - здесь селери якорь
##### Приложение coupons
##### Приложение cart

#### Работа с административной панелью

### Consultancy/Консультирование ###
Мы предоставляем полную консультационную поддержку касательно Doomarket. Пожалуйста, свяжитесь с *grabsomebuds27@gmail.com*, либо *w1ldboyzz@yandex.ru*
 для получения дополнительных пояснений по Вашим вопросам.









